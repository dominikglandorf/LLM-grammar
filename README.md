# LLM-grammar

This project about LLMs and their grammar representations is part of the Yale course CPSC488/588 "AI Foundation Models". The goal is to use GPT3.5 to augment the examples in the [EGP collection of grammar constructs](https://www.englishprofile.org/english-grammar-profile/egp-online), annotated with difficulty levels. The augmented dataset is used to train grammar detection heads on sentence embeddings generated by [ember-v1](https://huggingface.co/llmrails/ember-v1). They can be used to create a preference dataset or do rejection sampling when generating text.

## Prerequisites

- Ensure you have `conda` installed on your machine. 

### Installing the environment

1. To install the Conda environment for this project, run the following command:
```bash
conda env create -f environment.yml
```

2. Before running any scripts, ensure you activate the environment with:
```bash
conda activate llm-grammar
```

3. If you want to generate text using the Google Cloud. Install the gcloud CLI following their [guide](https://cloud.google.com/sdk/docs/install).

### Configuring the environment

1. Create a copy of `config.py.example` named `config.py` and insert your API keys and path to the gcloud credentials of a service account with the appropriate rights.

## Execute scripts

### Data augmentation

To create the augmented dataset, execute the python script `src/generate_examples.py` with the following options:
```
--examples-per-batch EXAMPLES_PER_BATCH
                    Positive and negative examples per batch (default: 20)
--batches BATCHES     Batches (default: 5)
--samples-per-level SAMPLES_PER_LEVEL
                    Samples per CEFR level (default: 1)
--input-file INPUT_FILE
                    Name of input file in folder dat (default: egponline.csv)
--output-file OUTPUT_FILE
                    Name of output file in folder dat (default: egpaugmented.json)
```

### Training the classification models

### Generate texts

### Evaluate texts with the classification models